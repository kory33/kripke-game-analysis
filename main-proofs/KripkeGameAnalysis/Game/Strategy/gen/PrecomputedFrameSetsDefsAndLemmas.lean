-- This file is not part of the autogenerated code, but contains definitions and lemmas
-- that are used in the autogenerated code in `PrecomputedFrameSets.lean`.

import KripkeGameAnalysis.ModalLogic.FiniteSemantics
import KripkeGameAnalysis.Game.Basic

namespace KripkeGameAnalysis.Precomputed

theorem map_image_retract_eq [DecidableEq α] (f : α ↪ β) (g : β → α) (sect : ∀ x, g (f x) = x) (s : Finset α) :
    (s.map f).image g = s := by
  ext x; simp only [Finset.mem_image, Finset.mem_map, exists_exists_and_eq_and]; grind

def idToFrameEquivClass (id : Fin 65536) : FiniteKripkeFrame.UptoIso 4 :=
  ⟦FiniteKripkeFrame.ofFin id⟧

lemma idToFrameEquivClass_retr (c : FiniteKripkeFrame.UptoIso 4) :
    idToFrameEquivClass (FiniteKripkeFrame.UptoIso.frameToId c) = c := by
  dsimp only [FiniteKripkeFrame.UptoIso.frameToId, DFunLike.coe]
  simp only [Nat.reducePow, Function.Embedding.toFun_eq_coe]
  exact SetoidWithCanonicalizer.canonicalRepresentative_section_of_quot _

def frameIdToRelCount (id : Fin 65536) : Nat :=
  (FiniteKripkeFrame.ofFin (n := 4) id).accessibilityRelationCount

lemma frameIdToRelCount_spec (id : Fin 65536) :
    frameIdToRelCount id = (idToFrameEquivClass id).accessibilityRelationCount := by
  simp [frameIdToRelCount, FiniteKripkeFrame.UptoIso.accessibilityRelationCount, idToFrameEquivClass, Quotient.lift_mk]

lemma filter_image_eq_image_filter {α β : Type*} [DecidableEq β]
    (s : Finset α) (f : α → β)
    (p₁ : β → Prop) [DecidablePred p₁]
    (p₂ : α → Prop) [DecidablePred p₂]
    (h : ∀ a, p₁ (f a) ↔ p₂ a) :
      (s.image f).filter p₁ = (s.filter p₂).image f := by grind only [= Finset.mem_filter, = Finset.mem_image, cases Or]

end KripkeGameAnalysis.Precomputed
